在 CQ HTTP 中，除了提供了最基本的消息上报，你还可以通过 EleCho.GoCqHttpSdk.MessageMatching 来获得拓展的，基于正则匹配的消息上报处理。

## 拓展方法

同样的，消息匹配拓展也提供了上报会话可用的消息匹配拓展方法，当正则匹配的时候，中间件会被执行：

```csharp
CqWsSession session;    // 要处理上报的会话

session.UseGroupMessageMatch("$echo .*", async (context, next) => {
    // 在这里处理消息上报 （这个消息一定是满足指定 pattern 的
});
```

和普通的上报拓展方法一样， 它同样也提供了不同的重载，同步中间件，包含或不包含下一个中间件参数的重载，按照你的需求选择不同的重载使用即可。

## 插件匹配

上报拓展还提供了一个可继承的插件基类，通过继承该类，并在类中写消息匹配的方法逻辑，插件则会自动调用这些方法。

```csharp
class MyMessageMatchingPlugin : CqMessageMatchingPostPlugin
{
    // 通过指定一个 CqMessageMatch 特性来使这个方法具备消息上报处理功能
    [CqMessageMatch("$echo ")]
    public void SomeMethod(
        CqGroupMessagePostContext context    // 指定一个 CqGroupMessagePostContext 参数
                                                  // 表示该方法会处理群消息上报
    )
    {
        // 在这里写具体逻辑
    }
}
```

在插件中定义的消息处理方法，通过指定一个任何 CqMessagePostContext 类或子类的参数表示处理特定类型的消息，